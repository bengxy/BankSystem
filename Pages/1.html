<html lang="en">
<head>
<meta charset="utf-8">
<link rel="stylesheet" type="text/css" href="../assets/css/jquery.dataTables.min.css">
<link href="../assets/css/glDatePicker.default.css" rel="stylesheet" type="text/css">
<link href="../assets/css/nav.css" rel="stylesheet">
<link href="../assets/css/bootstrap.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="box col-md-12" id="datePicker" align="center" style="height:200px">
                <p>
                开始时间<input type="text" id="begin" gldp-id="beginDate" />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                结束时间<input type="text" id="end" gldp-id="endDate" />
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <button class="search" id="btn" onclick="btnClick()">检索</button>
                </p>
                <div gldp-el="beginDate" style="width:400px; height:300px;"></div>
                <div gldp-el="endDate" style="width:400px; height:300px;"></div>
            </div>

            <div class="box col-md-3" id="nav">
                <ul class="nav nav-pills nav-stacked">
                    <li role="presentation" id="nav1"><a class="nav_a" href="1.html">月平均分时点等候人数变化图</a></li>
                    <li role="presentation" id="nav2"><a class="nav_a" href="2.html">月平均分时点弃号变化图</a></li>
                    <li role="presentation" id="nav3"><a class="nav_a" href="3.html">日客流人数、客等指数及时间占比</a></li>
                    <li role="presentation" id="nav4"><a class="nav_a" href="4.html">周实时队列变化图</a></li>
                    <li role="presentation" id="nav5"><a class="nav_a" href="5.html">月客流人数、客等指数及时间占比</a></li>
                    <li role="presentation" id="nav6"><a class="nav_a" href="6.html">客户排队人数对比</a></li>
                    <li role="presentation" id="nav7"><a class="nav_a" href="7.html">客户等候人数对比</a></li>
                    <li role="presentation" id="nav8"><a class="nav_a" href="8.html">月效率对比</a></li>
                    <li role="presentation" id="nav9"><a class="nav_a" href="9.html">渠道业务</a></li>
                </ul>
            </div>
            <div class="row col-md-9">
                <!-- <div id="main" class="col-md-9 main"></div> -->
                <div id="main" style="height:500px;border:1px solid #ccc;padding:10px;"></div>
                <h3 id="title_org" style="display:none">统计机构：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;**支行</h3>
                <h3 id="title_date" style="display:none">统计日期：&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20150901——20150930</h3>
                <table id="example" class="display" cellspacing="0" width="100%" style="display:none">
                    <thread>
                        <tr>
                            <th>统计机构</th>
                            <th>**支行</th>
                        </tr>
                    </thread>
                    <thead>
                        <tr>
                            <th>时段</th>
                            <th>等候人数</th>
                        </tr>
                    </thead>
                    <tfoot>
                        <tr>
                            <th>时段</th>
                            <th>等候人数</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>


    <script type="text/javascript" src="../assets/echarts/jquery.min.js"></script>
    <script type="text/javascript" src="../assets/echarts/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="../assets/echarts/d3.min.js"></script>
    <script type="text/javascript" src="../assets/echarts/echarts.js"></script>
    <script type="text/javascript" src="../assets/js/glDatePicker.min.js"></script>
    <script type="text/javascript" src="../assets/js/bootstrap.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            var global_active = "#nav1";
            $(global_active).addClass("active");
        });
        $(window).load(function(){
            $('input').glDatePicker();
        });
    </script>
    <script type="text/javascript">
        //console.log(1);
        var myChart;
        var option;
        var global_time = new Array();
        var global_weekday = new Array();
        var global_sunday = new Array();
        var global_saturday = new Array();
        

        require.config({
            paths: {
                echarts: '../assets/echarts'
            }
        });
        require(
            [
                'echarts',
                'echarts/chart/line',
                'echarts/chart/bar'
            ],
            function (ec) {
            
                myChart = ec.init(document.getElementById('main'));
                option = {
                    tooltip : {
                        trigger: 'axis'
                    },
                    title : {
                        text: '月平均分时点等候人数变化图',
                        //x:'center'
                    },
                    legend: {
                        data:['工作日','周六','周日']
                    },
                    toolbox: {
                        show : true,
                        feature : {
                            mark : {show: true},
                            dataView : {show: true, readOnly: false},
                        magicType : {show: true, type: ['line', 'bar']},
                            restore : {show: true},
                            saveAsImage : {show: true}
                        }
                    },
                    calculable : true,
                    xAxis : [
                        {
                            type : 'category',
                            boundaryGap : false,
                            data : global_time
                        }
                    ],
                    yAxis : [
                        {
                            type : 'value',
                            splitArea : {show : true}
                        }
                    ],
                    series : [
                        {
                            name:'工作日',
                            type:'line',
                            data: global_weekday,
                            markPoint : {
                                data : [
                                    {type : 'max', name: '最大值'},
                                    {type : 'min', name: '最小值'}
                                ]
                            },
                            markLine : {
                                data : [
                                    {type : 'average', name: '平均值'}
                                ]
                            }
                        },
                        {
                            name:'周六',
                            type:'line',
                            data:global_saturday,
                            markPoint : {
                                data : [
                                    {type : 'max', name: '最大值'},
                                    {type : 'min', name: '最小值'}
                                ]
                            },
                            markLine : {
                                data : [
                                    {type : 'average', name: '平均值'}
                                ]
                            }
                        },
                        {
                            name:'周日',
                            type:'line',
                            data:global_sunday,
                            markPoint : {
                                data : [
                                    {type : 'max', name: '最大值'},
                                    {type : 'min', name: '最小值'}
                                ]
                            },
                            markLine : {
                                data : [
                                    {type : 'average', name: '平均值'}
                                ]
                            }
                        }
                    ]
                };      
            }
        );
    </script>
    <script type="text/javascript">
        function btnClick(){
            console.log("1");
            $.ajax({
                url:"../PHP/1.php",
                type: "POST",
                data:{
                    format: "json",
                    start_time: "2015-09-21 08:30:00",
                    end_time: "2015-09-21 08:30:00"
                },
                dataType: "json",
            
                success: function(data){
                    global_weekday[0] = 0;
                    global_saturday[0] = 0;
                    global_sunday[0] = 0;
                    global_weekday[1] = 7;
                    global_saturday[1] = 4;
                    global_sunday[1] = 1;
                    global_time[0]="08:15:00";
                    global_time[1]="08:25:00";
                    for(var i =0;i < data[0].length;i++){
                        global_weekday[i+2] = data[0][i]*1;
                        global_saturday[i+2] = data[1][i]*1;
                        global_sunday[i+2] = data[2][i]*1;
                        global_time[i+2] = data[3][i];
                    }       
                    console.log("2");
                    myChart.setOption(option);
                    var dataNew = new Array();
                    for(var i =2;i < global_time.length-1;i++){
                        dataNew[i-2] = new Array();
                        dataNew[i-2][0] = global_time[i]+"至"+global_time[i+1];
                        dataNew[i-2][1] = global_weekday[i];
                    }
                    document.getElementById("example").style.display = "block";
                    document.getElementById("title_date").style.display = "block";
                    document.getElementById("title_org").style.display = "block";
                    var tabnew =  $('#example').DataTable( {
                        data: dataNew,
                        rows: [
                        { title: "时段" },
                        { title: "等候人数" },
                        ]
                    } );
                }
            });
        }
    </script>
</body>
</html>